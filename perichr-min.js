(function(root,doc,perichr,undefined){"use strict";if(root[perichr]){root[perichr].Load();return}var P=root[perichr]={},F=P.Functions={},U=P.Plugins={},_seed_=(new Date).getTime(),_script_cache_={},_plugin_cache_={},_const_=_plugin_cache_.CONST={},_fn_=_plugin_cache_.FN={},_options_=_plugin_cache_.OPTIONS={},Each=_fn_.each=F.ForEach=function(object,callback,force){var isArraylike=IsArraylike(object);if(force&&!isArraylike)object=[object];force||isArraylike?arr_each(object):obj_each(object);function arr_each(array){for(var index=0,length=array.length;index<length;index++){if(callback.call(array[index],index,array[index])===false)break}}function obj_each(object){for(var name in object){if(callback.call(object[name],name,object[name])===false)break}}},Index=_fn_.index=F.IndexOfArray=function(item,array){var index,length=array.length;for(index=0;length>index;index++)if(item==array[index])return index;return-1},IsArraylike=_fn_.arraylike=F.IsArraylike=function(object){var length=object.length,type=typeof object;if(/string|function/.test(type))return false;if(object.nodeType===1&&length)return true;return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in object},Arraify=_fn_.array=F.Arraify=function(object){var array=[];try{array=Array.prototype.slice.call(object,0)}catch(error){for(var item,array=[],i=0;item=object[i++];)array.push(item)}return array},Extend=_fn_.extend=F.Extend=function(target,object,override){for(var property in object)if(object.hasOwnProperty(property)&&(!target.hasOwnProperty(property)||override))target[property]=object[property];return target},Js=_fn_.js=F.CreateScript=function(src,callback,remove){if(typeof callback=="boolean"){remove=callback;callback=null}var s=_script_cache_[src]||{callback:[]},run_callback=function(){while(s.callback[0]){var callback=s.callback.shift();callback(200,"success")}};if(callback)s.callback.push(callback);if(s.ready){run_callback();return}src=Trim(src);if(_script_cache_[src])return;_script_cache_[src]=s;setTimeout(function(){var script=doc.createElement("script");script.id=GetScriptId(src);if(src.indexOf("http://")!=0){src=_options_.perichr_js_url+"/../"+src}script.src=src;script.onload=script.onreadystatechange=function(){if(!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(remove)script.parentNode.removeChild(script);s.ready=true;run_callback()}};doc.body.appendChild(script)},0)},Jsonp=_fn_.jsonp=F.Jsonp=function(src,cb){var cbname=Seed("cb");src+=(/\?/.test(src)?"&":"?")+"callback="+cbname;root[cbname]=function(data){cb(data)};Js(src,function(){delete root[cbname]},true)},Loader=_fn_.load=F.JsLoader=function(){var params=Arraify(arguments),load=function(){if(params.length>0){var argument=params.shift();if(!IsArraylike(argument))argument=[argument];go(argument)}},go=function(list){var remain=list.length,cb=function(){remain--;if(remain==0)load()};Each(list,function(){var item=this,type=typeof item;switch(type){case"string":Js(item,cb);break;case"function":item();cb();break;case"number":setTimeout(cb,item);break;default:cb();break}})};load()},Trim=_fn_.trim=F.Trim=function(string){return string.replace(/^(\s|\u00A0)+/,"").replace(/(\s|\u00A0)+$/,"")},Seed=_fn_.seed=F.Seed=function(prefix){return(prefix?Prefix(prefix):"")+_seed_++},Id=_fn_.id=F.GetElementById=function(id){return doc.getElementById(id)},Qs=_fn_.qs=F.QuerySelector=function(xpath){return doc.querySelector(xpath)},Qa=_fn_.qa=F.QuerySelectorAll=function(xpath){return doc.querySelectorAll(xpath)},El=_fn_.element=F.CreateElement=function(tag,attributes,childs){var element=doc.createElement(tag);if(attributes){Each(attributes,function(key,value){element.setAttribute(key,value)})}if(childs&&childs.length>0){Each(childs,function(){var settings=this;Append(element,El(settings.tag,settings.attributes,settings.childs))})}return element},Rm=_fn_.remove=F.RemoveElement=function(element){element.parentNode.removeChild(element)},Append=_fn_.append=F.AppendChild=function(target,element){target.appendChild(element)},Prepend=_fn_.prepend=F.PrependChild=function(target,element){if(target.hasChildNodes())target.insertBefore(element,target.firstChild);else target.appendChild(element)},Before=_fn_.before=F.BeforeChild=function(target,element){target.parentNode.insertBefore(element,target)},After=_fn_.after=F.AfterElement=function(target,element){var parent=target.parentNode;if(parent.lastChild===target)parent.appendChild(element);else parent.insertBefore(element,target.nextSibling)},On=_fn_.on=F.AddEvent=function(element,e,fn,capture){var add=doc.body.addEventListener?function(){this.addEventListener(e,fn,capture)}:function(){this.attachEvent("on"+e,fn)};capture=!!capture;Each(element,add,true)},Off=_fn_.off=F.RemoveEvent=function(element,e,fn,capture){var remove=doc.body.removeEventListener?function(){this.removeEventListener(e,fn,capture)}:function(){this.detachEvent("on"+e,fn)};capture=!!capture;Each(element,remove,true)},Serialize=_fn_.serialize=F.Serialize=function(object){var retval=[];for(key in object)key=[key,object[key]].join("="),retval.push(key);return retval.join("&")},Lo=P.Load=function(plugin){if(plugin){var script=Id(GetScriptId(plugin.id));if(!script)return;var key=plugin.id||Prefix("noname")+Seed(),cache={FN:{},CONST:{},OPTIONS:{}},getter=function(type){type=type.toLocaleUpperCase();return function(key,b){key=key.toLocaleLowerCase();return b?cache[type][key]:_plugin_cache_[type][key]}},gsetter=function(type,callback){type=type.toLocaleUpperCase();return function(key,value){key=key.toLocaleLowerCase();if(value===undefined){return cache[type][key]||_plugin_cache_[type][key]}else{cache[type][key]=value;callback&&callback(key,value)}}};plugin.options=cache.OPTIONS=JSON.parse(script.getAttribute("data-options")||"{}");cache.OPTIONS.src=script.src;U[key]=plugin;plugin.GetPlugin=function(key){return key?U[key]:plugin};plugin.Options=gsetter("options");plugin.GetConst=getter("const");plugin.GetFn=getter("fn");plugin.Const=gsetter("const");plugin.fn=gsetter("fn",function(name,func){plugin.fn[name]=func||_fn_[name]});Each(_fn_,function(name,func){plugin.fn[name]=func});plugin.Init&&plugin.Init(cache.OPTIONS);Rm(script)}else{var script=Id(GetScriptId());if(!script)return;var datainit=script.getAttribute("data-init"),dataoptions=script.getAttribute("data-options");_options_.perichr_js_url=script.src;if(dataoptions){Extend(_options_,JSON.parse(dataoptions))}if(datainit){var i=0;datainit=datainit.split(",");Loader.apply(null,datainit)}Rm(script)}};Lo();function GetScriptId(str){str=str?str.substring(str.lastIndexOf("/")+1).replace(/\?|\.|&|=/g,"_"):"js";return Prefix(str)}function Prefix(key){return perichr+key+"_"}})(window,document,"_perichr_");